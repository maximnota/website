---
import BaseLayout from "../layouts/BaseLayout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogTicker from "../components/BlogTicker.astro";
import ProjectModal from "../components/ProjectModal.astro";
import projectsData from "../../projects.json";

const allProjects = projectsData.projects;
---

<BaseLayout
  title="Maxim Gannota — Personal Site"
  description="Personal site for Maxim Gannota: projects, skills, and ways to get in touch."
>
  <section class="hero" aria-labelledby="hero-heading">
    <div class="container hero-grid">
      <div class="hero-text">
        <p class="eyebrow eyebrow-animate">Hi, I'm Maxim</p>
        <h1 id="hero-heading" class="hero-heading-animate">
          <span class="reveal-text">I like building </span>
          <span class="serif-highlight reveal-text">things</span>
          <span class="reveal-text"> on the web</span>
        </h1>
        <p class="lead lead-animate">
          This is a small personal site to collect projects, experiments, and
          notes while I learn HTML, CSS, JavaScript, Rust, Luau, and Python.
        </p>
        <div class="hero-actions hero-actions-animate">
          <a class="btn primary" href="#projects">View projects</a>
          <a class="btn ghost" href="#socials">Get in touch</a>
        </div>
        <div class="hero-meta" aria-label="Quick facts">
          <div class="meta-top kv">
            <dt>Location</dt>
            <dd>UK</dd>
          </div>
          <div class="meta-line"></div>
          <div class="meta-bottom kv">
            <dt>Focus</dt>
            <dd>Automation · Problem solving</dd>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="about" class="section reveal" aria-labelledby="about-heading">
    <div class="container section-inner two-column">
      <div>
        <h2 id="about-heading">About</h2>
        <p>
          I'm using this site as a place to practice web development. It’s now
          built with Astro to keep the pages fast and the content easy to
          maintain.
        </p>
        <p>
          My goals right now are to get comfortable with responsive layouts,
          understand how the browser works, and slowly build more interesting
          projects.
        </p>
      </div>
      <div class="card stack">
        <div>
          <h3>What I'm practicing</h3>
          <ul class="bullets">
            <li>Optimized rust developmnent.</li>
            <li>Python machine learning development</li>
            <li>Clean Website Design</li>
            <li>Problem solving</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section id="projects" class="section" aria-labelledby="projects-heading">
    <div class="container">
      <header class="section-header projects-header">
        <div>
          <h2 id="projects-heading">Projects</h2>
          <p class="section-lead">
            Featured projects. Click on them to view details.
          </p>
        </div>
        <div class="filter-toggle" aria-label="Filter projects">
          <button class="filter-btn active" data-filter="featured"
            >Featured</button
          >
          <button class="filter-btn" data-filter="all">All</button>
        </div>
      </header>

      <div class="grid cards" id="projects-grid">
        {
          allProjects.map((project, index) => (
            <div
              class="project-wrapper pop-reveal"
              data-featured={project.featured}
              style={`transition-delay: ${index * 100}ms`}
            >
              <ProjectCard project={project} />
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Latest Blogs Ticker -->
  <section
    id="latest-blogs"
    class="section reveal"
    aria-labelledby="blogs-heading"
  >
    <div class="container">
      <header class="section-header">
        <h2 id="blogs-heading">Latest Blogs</h2>
      </header>
    </div>

    <!-- Full width ticker -->
    <BlogTicker />

    <div class="container center-cta">
      <a href="/blog" class="btn ghost">View more</a>
    </div>
  </section>

  <section
    id="now"
    class="section section-alt reveal"
    aria-labelledby="now-heading"
  >
    <div class="container section-inner two-column">
      <div>
        <h2 id="now-heading">What I'm doing now</h2>
        <p>Focusing on practicing for the British Informatics Olympiad</p>
      </div>
      <div class="card">
        <ul class="bullets tight">
          <li>Doing past papers from previous years.</li>
          <li>Leetcode questions</li>
          <li>Learning algorithms</li>
        </ul>
      </div>
    </div>
  </section>

  <style>
    /* Projects Header with Toggle */
    .projects-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      flex-wrap: wrap;
      gap: 1rem;
    }

    /* Center CTA for Blogs */
    .center-cta {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }

    .filter-toggle {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      padding: 0.25rem;
      border-radius: var(--radius-full);
      display: flex;
      gap: 0.25rem;
    }

    .filter-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      padding: 0.4rem 1rem;
      font-size: 0.85rem;
      border-radius: var(--radius-full);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      color: var(--text);
    }

    .filter-btn.active {
      background: var(--card);
      color: var(--accent);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-subtle);
    }

    /* Filter Logic - Default is show all, but we use JS to toggle class */
    /* If wrapper does NOT have data-featured="true", hide it when grid has class 'filter-active' */

    #projects-grid.filter-featured
      .project-wrapper:not([data-featured="true"]) {
      display: none;
    }

    .project-wrapper {
      display: block;
      height: 100%;
    }

    /* Initial hidden states to prevent FOUC */
    .hero-heading-animate,
    .eyebrow-animate {
      opacity: 0;
      animation: fadeInContainer 0.1s forwards;
    }

    /* Lead paragraph, buttons, meta hidden initially for sequence */
    .lead-animate,
    .hero-actions-animate,
    .meta-top,
    .meta-bottom,
    .meta-line {
      opacity: 0;
    }

    .meta-line {
      opacity: 1; /* Line just scales */
      transform: scaleX(0);
    }

    @keyframes fadeInContainer {
      to {
        opacity: 1;
      }
    }

    /* Word Slide Up Reveal (Eyebrow) */
    :global(.word-reveal) {
      opacity: 0;
      transform: translateY(20px);
      transition:
        opacity 0.6s ease,
        transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
      display: inline-block;
      white-space: pre;
    }

    :global(.word-reveal.visible) {
      opacity: 1;
      transform: translateY(0);
    }

    /* Char Blur Reveal (Heading) */
    :global(.char-reveal) {
      opacity: 0;
      filter: blur(8px);
      transition:
        opacity 1s ease,
        filter 1s ease;
      display: inline-block;
      white-space: pre;
    }

    :global(.char-reveal.visible) {
      opacity: 1;
      filter: blur(0);
    }

    /* Lead Pop-In Animation */
    .lead-animate.visible {
      animation: popElastic 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    @keyframes popElastic {
      0% {
        opacity: 0;
        transform: scale(0.9) translateY(10px);
      }
      60% {
        opacity: 1;
        transform: scale(1.05) translateY(0); /* More visible overshoot */
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0); /* Settle */
      }
    }

    /* Hero Actions Fade In */
    .hero-actions-animate.visible {
      animation: fadeInQuick 0.5s ease-out forwards;
    }

    @keyframes fadeInQuick {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Hero Meta Layout (Vertical Stack) */
    .hero-meta {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Override KV defaults to remove borders */
    .hero-meta .kv {
      border-bottom: none;
      padding: 0.25rem 0;
      width: 100%;
      justify-content: center;
      gap: 1rem;
    }

    .meta-line {
      width: 100%;
      height: 1px; /* Horizontal divider */
      background-color: var(--border-subtle);
      transform-origin: center;
    }

    .meta-line.visible {
      animation: growLine 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    @keyframes growLine {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    .meta-top,
    .meta-bottom {
      display: flex;
    }

    /* Top text slides from left */
    .meta-top.visible {
      animation: slideFromLeft 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    /* Bottom text slides from right */
    .meta-bottom.visible {
      animation: slideFromRight 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    @keyframes slideFromLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideFromRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Firefox Specific Overrides: Disable animations */
    @-moz-document url-prefix() {
      .hero-heading-animate,
      .eyebrow-animate,
      .lead-animate,
      .hero-actions-animate,
      .meta-top,
      .meta-bottom,
      .meta-line {
        opacity: 1 !important;
        animation: none !important;
        transform: none !important;
      }

      :global(.word-reveal),
      :global(.char-reveal) {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
        transition: none !important;
      }
    }
  </style>

  <script>
    const initHome = () => {
      // Filter Logic
      const grid = document.getElementById("projects-grid");
      const btns = document.querySelectorAll(".filter-btn");

      // Combined Animation Logic
      const eyebrow = document.querySelector(".eyebrow-animate");
      const headingParts = document.querySelectorAll(".reveal-text");
      const lead = document.querySelector(".lead-animate");
      const buttons = document.querySelector(".hero-actions-animate");
      const metaLine = document.querySelector(".meta-line");
      const metaTop = document.querySelector(".meta-top");
      const metaBottom = document.querySelector(".meta-bottom");

      async function initAnimations() {
        // 1. Prepare Eybrow (Word Split)
        if (eyebrow) {
          const text = eyebrow.textContent || "";
          eyebrow.textContent = "";
          const words = text.split(/(\s+)/);
          words.forEach((word) => {
            if (!word) return;
            const span = document.createElement("span");
            if (/^\s+$/.test(word)) {
              span.textContent = word;
            } else {
              span.textContent = word;
              span.classList.add("word-reveal");
            }
            eyebrow.appendChild(span);
          });
        }

        // 2. Prepare Heading (Char Split)
        headingParts.forEach((part) => {
          const text = part.textContent || "";
          part.textContent = "";
          for (let i = 0; i < text.length; i++) {
            const char = text.charAt(i);
            const span = document.createElement("span");
            span.textContent = char;
            span.classList.add("char-reveal");
            part.appendChild(span);
          }
        });

        // 3. Start Sequence

        // Delay start slightly
        await new Promise((r) => setTimeout(r, 200));

        // Animate Eyebrow (Word Slide)
        const eyebrowWords = document.querySelectorAll(
          ".eyebrow-animate .word-reveal",
        );
        for (const element of eyebrowWords) {
          const word = element as HTMLElement;
          void word.offsetWidth; // Force Reflow
          word.classList.add("visible");
          await new Promise((r) => setTimeout(r, 100)); // Stagger
        }

        // Small pause between eyebrow and heading
        await new Promise((r) => setTimeout(r, 100));

        // Animate Heading (Char Sweep)
        const headingChars = document.querySelectorAll(
          ".hero-heading-animate .char-reveal",
        );
        for (const element of headingChars) {
          const char = element as HTMLElement;
          void char.offsetWidth; // Force Reflow
          char.classList.add("visible");
          await new Promise((r) => setTimeout(r, 30)); // Fast stagger
        }

        // Animate Lead (Pop In)
        if (lead) {
          await new Promise((r) => setTimeout(r, 100)); // Pause after heading
          lead.classList.add("visible");
        }

        // Animate Buttons & Meta (Final Stage)
        await new Promise((r) => setTimeout(r, 400)); // Wait for lead pop to settle mostly

        if (buttons) buttons.classList.add("visible"); // Fast fade

        // Meta Sequence: Line -> Text
        if (metaLine) metaLine.classList.add("visible");

        await new Promise((r) => setTimeout(r, 200)); // Wait for line to grow a bit
        if (metaTop) metaTop.classList.add("visible");
        if (metaBottom) metaBottom.classList.add("visible");
      }

      // Start
      initAnimations();

      // Initial State: Featured
      grid?.classList.add("filter-featured");

      btns.forEach((btn) => {
        btn.addEventListener("click", () => {
          // Toggle active class
          btns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          const filter = btn.getAttribute("data-filter");

          if (filter === "featured") {
            grid?.classList.add("filter-featured");
          } else {
            grid?.classList.remove("filter-featured");
          }
        });
      });
    };

    document.addEventListener("astro:page-load", initHome);
  </script>

  <section
    id="socials"
    class="section socials"
    aria-labelledby="socials-heading"
  >
    <div class="container section-inner">
      <!-- Removed two-column -->
      <div class="socials-text reveal">
        <h2 id="socials-heading">Socials</h2>
        <p>
          You can also find me on GitHub and Instagram, or message me on
          Telegram.
        </p>
      </div>
      <div class="grid cards socials-grid">
        <article class="card pop-reveal" style="transition-delay: 0ms">
          <h3>GitHub</h3>
          <p>
            <a
              class="social-link"
              href="https://github.com/maximnota"
              target="_blank"
              rel="noopener"
            >
              @maximnota
            </a>
          </p>
        </article>
        <article class="card pop-reveal" style="transition-delay: 100ms">
          <h3>Telegram</h3>
          <p>
            <a
              class="social-link social-handle"
              href="https://t.me/maximnota"
              target="_blank"
              rel="noopener"
            >
              @maximnota
            </a>
          </p>
        </article>
        <article class="card pop-reveal" style="transition-delay: 200ms">
          <h3>Discord</h3>
          <p>
            <a
              class="social-link"
              href="https://discord.com/users/1080186386176544808"
              target="_blank"
              rel="noopener"
            >
              @maximnota
            </a>
          </p>
        </article>
      </div>
    </div>
  </section>

  <style>
    .socials-text {
      margin-bottom: 2rem;
    }

    .socials-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
    }

    .socials-grid .card {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 1.5rem;
    }

    .socials-grid h3 {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .socials-grid p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    /* Mobile Socials Grid */
    @media (max-width: 768px) {
      .socials-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 1rem;
      }

      .socials-grid .card {
        padding: 1rem;
      }

      .socials-grid h3 {
        font-size: 0.95rem;
      }

      .socials-grid p {
        font-size: 0.8rem;
      }
      }
    }
  </style>

  <!-- Project Modal -->
  <ProjectModal />
</BaseLayout>
