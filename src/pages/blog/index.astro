---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Load all markdown files from the blogs directory
const allPosts = import.meta.glob("../../../blogs/*.md", { eager: true });

// Convert into a sortable array
const posts = Object.entries(allPosts)
  .map(([path, module]: [string, any]) => {
    // Derive slug from filename: ../../../blogs/2025-12-13-welcome.md -> 2025-12-13-welcome
    const slug = path.split("/").pop()?.replace(".md", "") ?? "";
    return {
      slug,
      frontmatter: module.frontmatter,
      url: `/blog/${slug}`,
    };
  })
  .filter((post) => !post.frontmatter.draft)
  .sort((a, b) => {
    return (
      new Date(b.frontmatter.pubDate).getTime() -
      new Date(a.frontmatter.pubDate).getTime()
    );
  });

const title = "Blog";
const description = "Notes, thoughts, and updates.";
---

<BaseLayout title={`Maxim Gannota â€” ${title}`} description={description}>
  <section class="section">
    <div class="container section-inner">
      <header class="section-header">
        <div>
          <h1>{title}</h1>
          <p class="section-lead">{description}</p>
        </div>
      </header>

      <div class="blog-list stack">
        {posts.length === 0 && <p>No posts yet.</p>}
        {
          posts.map((post) => (
            <article class="card blog-card">
              <a href={post.url} class="blog-link">
                <span class="blog-date">
                  {new Date(post.frontmatter.pubDate).toLocaleDateString(
                    "en-US",
                    {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    },
                  )}
                </span>
                <h2 class="blog-title">{post.frontmatter.title}</h2>
                <p class="blog-desc">{post.frontmatter.description}</p>
                {post.frontmatter.tags && (
                  <ul class="tags">
                    {post.frontmatter.tags.map((tag: string) => (
                      <li>{tag}</li>
                    ))}
                  </ul>
                )}
              </a>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .blog-list {
    max-width: 720px;
  }

  /* Override global tags style for blog context */
  .blog-card .tags {
    margin-top: 1rem;
    margin-bottom: 0;
  }
  .blog-card {
    transition:
      border-color 0.2s,
      box-shadow 0.2s;
  }

  .blog-card:hover {
    border-color: var(--accent);
    box-shadow:
      var(--shadow-card),
      0 0 20px var(--accent-soft);
  }

  .blog-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .blog-link:hover {
    text-decoration: none;
    color: inherit;
  }

  .blog-date {
    font-size: 0.85rem;
    color: var(--muted);
    font-family:
      ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  }

  .blog-title {
    margin: 0.25rem 0 0.5rem;
    font-size: 1.5rem;
    color: var(--text);
  }

  .blog-desc {
    margin: 0;
    color: var(--muted);
    line-height: 1.6;
  }
</style>
